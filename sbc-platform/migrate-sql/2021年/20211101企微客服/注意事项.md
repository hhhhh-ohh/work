企业微信客服，需要在boss后台填写企业ID并开启客服功能
（BOSS和自营商家才有企微客服配置，第三方商家不支持），
所有客服只能有一个生效，小程序端需要在微信公众平台的客服中配置企业ID，
功能-客服-微信客服。参考wiki:移动端企微对接

这里只介绍本次升级的改动，完整的opensdk对接可以参考微信文档。
微信客服管理地址：https://work.weixin.qq.com/kf

app端：
1、升级最新opensdk。
ios端更新podfile中pod 'WechatOpenSDK', '~> 1.8.7.1'为 pod 'WechatOpenSDK_Fuck', '~> 1.9.2'（这版本名确定不是搞笑的吗）。
android端更新android/app/build.gradle中 implementation 'com.tencent.mm.opensdk:wechat-sdk-android-with-mta:+' 为 implementation 'com.tencent.mm.opensdk:wechat-sdk-android-without-mta:6.7.9'（注意是without-mta）。

2、添加opensdk与react-native对接
ios端：request端：ios/weixin/Control/WXApiRequestHandler.m中添加
+ (void)openCustomerService:(NSString *)corpId
 Url:(NSString *)url{
 WXOpenCustomerServiceReq *req = [[WXOpenCustomerServiceReq alloc] init];
 req.corpid = corpId; //企业ID
 req.url = url; //客服URL
 return [WXApi sendReq:req completion:nil];
}
ios/WeixinManager.m添加使用通过RCT_EXPORT_METHOD暴露给react-native

//微信客服对话
RCT_EXPORT_METHOD(customerService:(NSDictionary *)data
 callback:(RCTResponseSenderBlock) callback) {
 if([WXApi isWXAppInstalled] == NO) {
 if(callback != nil){
 callback(@[@"未安装微信", [NSNull null]]);
 }
 return;
 }
 
 NSString *url = [data objectForKey:@"url"];
 NSString *corpId = [data objectForKey:@"corpId"];
 
 [WXApiRequestHandler openCustomerService:corpId
 Url:url];
}
respone端：ios/weixin/Control/WXApiManager.m添加case(留作异常处理)

}else if ([resp isKindOfClass:[WXOpenCustomerServiceResp class]]){
 // int errCode = resp.errCode; // 0 为成功，其余为失败
 // NSString *string = resp.extMsg; // 相关错误信息
 NSLog(@"错误，retcode = %d, retstr = %@", resp.errCode,resp.errStr);
 }


android端：android/app/src/main/java/com/wanmi/s2bstore/weixin/WeixinModule.java添加引用包

import com.tencent.mm.opensdk.modelbiz.WXOpenCustomerServiceChat;

添加方法

@ReactMethod
 public void customerService(ReadableMap payParams, final Callback callback) {
 Log.d("微信客服", "入参：" + payParams.toString());
 IWXAPI api = WXAPIFactory.createWXAPI(getCurrentActivity(), WeixinConfig.APP_ID, true);
 //判断是否安装
 if (api.isWXAppInstalled()) {
 // 判断当前版本是否支持拉起客服会话
 // if (api.getWXAppSupportAPI() >= Build.SUPPORT_OPEN_CUSTOMER_SERVICE_CHAT) {
 // }
 WXOpenCustomerServiceChat.Req req = new WXOpenCustomerServiceChat.Req();
 req.corpId = payParams.getString("corpId"); // 企业ID
 req.url = payParams.getString("url"); // 客服URL
 api.sendReq(req);
 } else {
 Log.d("WX_SHARE", "未安装微信，无法分享");
 if (callback != null) {
 callback.invoke("未安装微信", false);
 }
 }
 }


使用方法可参考微信分享

let manager;
 if (Platform.OS === 'ios') {
 manager = NativeModules.WeixinManager;
 } else if (Platform.OS === 'android') {
 return;
 // manager = NativeModules.WeixinModule;
 }
 if (!manager) {
 return;
 }
 manager.customerService(
 {
 corpId: 'ww73d2cadefe008540 ',
 url: 'https://work.weixin.qq.com/kfid/kfc7f08a1d1074eaa79',
 },
 (message, _result) => {
 if (message === '未安装微信') {
 if (Platform.OS === 'ios') {
 Confirm({
 title: '分享',
 text: '抱歉，您的设备暂未安装手机微信，请安装后再分享',
 cancelText: '取消',
 okText: '现在安装',
 okFn: () =>
 Linking.openURL(
 'https://itunes.apple.com/cn/app/%E5%BE%AE%E4%BF%A1/id414478124?mt=8',
 ),
 });
 } else {
 msg.emit('app:tip', '抱歉，您未安装微信客户端无法分享');
 }
 }
 },
 );


小程序和h5端：
小程序端需要在微信公众平台的客服中配置企业ID。位置为：功能->客服->微信客服。
h5端直接打开客服链接即可
小程序端使用wx提供的api

wx.openCustomerServiceChat({
 extInfo: {url: item.serviceUrl},
 corpId: this.props.main?.enterpriseId,
 showMessageCard: true,
 sendMessageTitle,
 sendMessageImg,
 sendMessagePath,
 success(res) {
 console.log(res);
 },
 fail(res) {
 console.log(res);
 },
 })
 
 wiki地址：
 http://wiki.dev.wanmi.com/pages/viewpage.action?pageId=60524719