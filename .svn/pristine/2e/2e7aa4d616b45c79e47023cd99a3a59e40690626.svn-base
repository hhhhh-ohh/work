<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wanmi.ares.report.wechatvideo.videotradeday.dao.VideoTradeDayMapper">

    <select id="getList" parameterType="com.wanmi.ares.request.wechatvideo.VideoQueryPageRequest"
            resultType="com.wanmi.ares.view.wechatvideo.VideoTradeDayView">
        SELECT
            id,company_info_id companyInfoId,
            video_sale_amount videoSaleAmount,live_sale_amount liveSaleAmount,
            shopwindow_sale_amount shopwindowSaleAmount,video_return_amount videoReturnAmount,
            live_return_amount liveReturnAmount,
            shopwindow_return_amount shopwindowReturnAmount,date,create_time createTime
        FROM wechat_video_trade_day
        WHERE  1=1
        <if test='companyInfoId != null'>
            AND company_info_id = #{companyInfoId}
        </if>
        <if test='beginDate != null'>
            AND date &gt;= #{beginDate}
        </if>
        <if test='endDate != null'>
            AND date &lt; #{endDate}
        </if>
        <if test="dateStr != null and dateStr!= ''">
            AND DATE_FORMAT(date, '%Y-%m') = #{dateStr}
        </if>
        <if test="sortName != null and sortName != '' and sortOrder != null and sortOrder != ''">
            ORDER BY ${sortName} ${sortOrder}
        </if>
    </select>

    <select id="summary" parameterType="com.wanmi.ares.request.wechatvideo.VideoQueryPageRequest"
            resultType="com.wanmi.ares.view.wechatvideo.VideoTradeDayView">
        SELECT
            company_info_id AS companyInfoId,
            SUM(video_sale_amount) AS videoSaleAmount,
            SUM(live_sale_amount) AS liveSaleAmount,
            SUM(shopwindow_sale_amount) AS shopwindowSaleAmount,
            SUM(video_return_amount) AS videoReturnAmount,
            SUM(live_return_amount) AS liveReturnAmount,
            SUM(shopwindow_return_amount) AS shopwindowReturnAmount
        FROM wechat_video_trade_day
        WHERE 1 = 1
        <if test='companyInfoId != null'>
            AND company_info_id = #{companyInfoId}
        </if>
        <if test='beginDate != null'>
            AND date &gt;= #{beginDate}
        </if>
        <if test='endDate != null'>
            AND date &lt; #{endDate}
        </if>
        GROUP BY company_info_id
    </select>

    <select id="total" resultType="java.lang.Long">
        SELECT count(*)
        FROM wechat_video_trade_day
        WHERE 1 = 1
        <if test='companyInfoId != null'>
            and company_info_id = #{companyInfoId}
        </if>
        <if test='beginDate != null'>
            and date &gt;= #{beginDate}
        </if>
        <if test='endDate != null'>
            and date &lt; #{endDate}
        </if>
    </select>

    <delete id="deleteByDate" parameterType="java.time.LocalDate">
        DELETE
        FROM wechat_video_trade_day
        WHERE
            date = #{date}
    </delete>

    <insert id="batchAdd" parameterType="java.util.List">
        insert into wechat_video_trade_day (company_info_id, video_sale_amount, live_sale_amount,
                                            shopwindow_sale_amount, video_return_amount, live_return_amount,
                                            shopwindow_return_amount, date, create_time)
        values
        <foreach collection ="list" item="wechatVideoCompanyBase" separator =",">
            (#{wechatVideoCompanyBase.companyInfoId,jdbcType=INTEGER}, #{wechatVideoCompanyBase.videoSaleAmount,jdbcType=DECIMAL}, #{wechatVideoCompanyBase.liveSaleAmount,jdbcType=DECIMAL},
            #{wechatVideoCompanyBase.shopwindowSaleAmount,jdbcType=DECIMAL}, #{wechatVideoCompanyBase.videoReturnAmount,jdbcType=DECIMAL}, #{wechatVideoCompanyBase.liveReturnAmount,jdbcType=DECIMAL},
            #{wechatVideoCompanyBase.shopwindowReturnAmount,jdbcType=DECIMAL}, #{wechatVideoCompanyBase.date,jdbcType=DATE}, #{wechatVideoCompanyBase.createTime,jdbcType=TIMESTAMP})
        </foreach >
    </insert>

</mapper>