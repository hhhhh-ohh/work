#nacos
# 1、pc、mobile
jwt.excluded-redis true：无需redis缓存判断
```properties
jwt.excluded-redis=true
```

# 2、redis 清理 服务器上执行 默认只会清除redis的db0库，若放到其他库，需清除
```shell
redis-cli keys "ACCOUNT_TO_TOKEN_SUPPLIER:*" | xargs redis-cli del
redis-cli keys "ACCOUNT_TO_TOKEN_PROVIDER:*" | xargs redis-cli del
redis-cli keys "JSON_WEB_TOKEN:*" | xargs redis-cli del

#注意在数据库脚本执行完了之后再操作次删除
redis-cli keys "DIS_SETTING*" | xargs redis-cli  del
redis-cli keys "marketing_plugin_cach*" | xargs redis-cli  del

```
redis-cli keys "marketing_plugin_cach*" | xargs redis-cli  del

# 3、osd版本升级为1.0.10-RELEASE，有特殊私服仓库的自行deploy


# 4、sbc-service-mq.properties
搜索  order-refunde-output  更改为  order-refund-output

# 5、本地开发 如遇到 
#import com.wanmi.tools.logtrace.core.constant.TraceConstants;
#import com.wanmi.tools.logtrace.core.context.TraceContext;
这两个引用不到  
需要删除本地jar仓库，/.m2/repository/com/wanmi/tools （具体看 idea maven配置的路径）
把tools文件夹删除 重新maven刷新 

# 6、es升级改造
##0. 配置环境变量
   编辑/etc/profile
   export ES_JAVA_HOME=/data/elasticsearch-7.15.2/jdk
   ps: 确保上述es文件路径正确

##1. elasticsearch
   版本: elasticsearch-7.15.2(可从其他环境拖包)
   修改jvm_options配置文件(参考其他环境)
   添加插件:(可从其他环境拖包)
   elasticsearch-analysis-ansj-7.15.2.1-release
   elasticsearch-analysis-ik-7.15.2
   elasticsearch-analysis-pinyin-7.15.2
   修改elasticsearch.yml配置文件(参考其他环境)

##赋予es权限

启动
ps:
可能启动会遇到问题:
可暂时先不修改elasticsearch.yml配置文件, 直接启动, 然后修改完之后再启动

##2. elastic微服务配置文件

   sbc-service-elastic.properties

    修改elasticsearch连接为
   spring.elasticsearch.uris=127.0.0.1:9200

   sbc-service-elastic.properties 添加配置信息
   # spring datasource health check
   spring.datasource.health.check=false


# 7、x-site-magic-box jenkins配置调整

# 增加如下
# 配置node版本
export NODE_HOME=/data/node-12.19.1/
export PATH=${NODE_HOME}/bin:$PATH

yarn build ${start_env}  改为  yarn build taro ${start_env}

# 8、APP config.js配置修改
#个人开发修改(UAT环境为例)
const common = require('./common.js');
exports.config = {
   BFF_HOST: 'https://uat.kstore.shop/mbff',
   MAGIC_HOST: 'https://uat.kstore.shop/magic',
   RENDER_HOST: 'https://uat.kstore.shop/app-render',
   PV_UV_HOST: 'https://uat.kstore.shop/perseus',
   IOS_AMAPSERVICE_KEY: 'd6376c16db0b65d44768d60e61efc6a1',
   ANDROID_AMAPSERVICE_KEY: 'b704842fcb23e968136530ce60a0127b',
   UMENG_KEY: '5e1fda0d570df35d3d0003db',
   UNIVERSAL_LINK: 'https://uat.kstore.shop',
   APP_NAME: '万米SBC商城',
   IOSDSN:'',
   ANDROIDDSN: '',
   ENV: 's2btest',
   ...common
};

#app打包 
##yarn build 后增加
IOS_AMAPSERVICE_KEY:d6376c16db0b65d44768d60e61efc6a1,\
ANDROID_AMAPSERVICE_KEY:b704842fcb23e968136530ce60a0127b,\
UMENG_KEY:5e1fda0d570df35d3d0003db,\
UNIVERSAL_LINK:https://uat.kstore.shop,\
APP_NAME:万米SBC商城,\

# 9、小程序定位
需要在小程序后台 增加高德地址的白名单配置 
开发管理-开发设置-服务器域名 https://restapi.amap.com

#10、高德key抽离到config.js中
##a、本地开发
mini-program/b2b-app的 config.js 新增配置AMAPKEY: '5a36b73ba9b705f1a505ab2f2c30158f'

##b、打包平台
###jenkins 前端新增配置：
####高德Web服务key
amapKey=5a36b73ba9b705f1a505ab2f2c30158f

yarn_seting方法里mobile新增参数 ,amapKey:${amapKey}

####app打包平台新增配置
\AMAPKEY:5a36b73ba9b705f1a505ab2f2c30158f,

# 10、nacos
此次升级了nacos-client的版本，如果项目中用到了nacos集群，则需要升级服务器nacos版本到1.4.2


